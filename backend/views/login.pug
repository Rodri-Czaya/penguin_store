doctype html
html
    head
        title Admin Login
        style.
            body {
                font-family: Arial, sans-serif;
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100vh;
                margin: 0;
                background-color: #f5f5f5;
            }
            .login-form {
                background: white;
                padding: 20px;
                border-radius: 5px;
                box-shadow: 0 0 10px rgba(0,0,0,0.1);
            }
            input {
                display: block;
                margin: 10px 0;
                padding: 8px;
                width: 200px;
            }
            button {
                background: #007bff;
                color: white;
                border: none;
                padding: 10px;
                width: 100%;
                cursor: pointer;
            }
            .error {
                color: red;
                display: none;
                margin-bottom: 10px;
            }
    body
        div.login-form
            h2 Admin Login
            div.error Error: Invalid credentials
            form#loginForm
                input(type='text' name='username' placeholder='Username' required)
                input(type='password' name='password' placeholder='Password' required)
                button(type='submit') Login

        script.
            document.getElementById('loginForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const errorDiv = document.querySelector('.error');
                errorDiv.style.display = 'none';
                
                const formData = new FormData(e.target);
                const data = {
                    username: formData.get('username'),
                    password: formData.get('password')
                };

                try {
                    const response = await fetch('/auth/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });

                    const result = await response.json();

                    if (response.ok && result.token) {
                        // Store token
                        localStorage.setItem('adminToken', result.token);
                        
                        // Create a form to carry the token
                        const form = document.createElement('form');
                        form.method = 'GET';
                        form.action = '/products';

                        const tokenInput = document.createElement('input');
                        tokenInput.type = 'hidden';
                        tokenInput.name = 'token';
                        tokenInput.value = result.token;

                        form.appendChild(tokenInput);
                        document.body.appendChild(form);
                        form.submit();
                    } else {
                        errorDiv.style.display = 'block';
                        errorDiv.textContent = result.message || 'Invalid credentials';
                    }
                } catch (error) {
                    console.error('Error:', error);
                    errorDiv.style.display = 'block';
                    errorDiv.textContent = 'An error occurred. Please try again.';
                }
            });